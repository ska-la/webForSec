# Руководство
Данная задача была реализована в ходе курсовой работы. Цель: добавить возможность управления реле замков через интерфейс, отличный от предлагаемого производителем. Веб-интерфейс - идеальное решение для любого мобильного устройства, без привязки приложения к какой-либо конкретной платформе.

---

**Внимание!!!** Данное решение ни коим образом не предназначено для создания обходных путей СКУД. Следует иметь ввиду, что эксплуатация данного ПО без ведома руководства предприятия, тем более в корыстных целях, может стоить Вам рабочего места. Поэтому, настоятельно рекомендуется, поставить в известность начальника IT-подразделения о том, что вы собираетесь сделать или уже сделали.

---

Развёртывание (установка и настройка) потребует определённых знаний и навыков работы в некоторых дополнительных инструментах, таких как сетевой сниффер WireShark и клиент командной строки БД FireBird - isql.exe (isql-fb для Linux). В детали этих инструментов (что,как и почему) мы вдаваться не будем. Будет только пошаговое руководство. Рекомендации: НЕ СТОИТ НИЧЕГО ПЕРЕИМЕНОВЫВАТЬ, ДО ТОГО, КАК ВСЁ ЗАРАБОТАЕТ (кроме того, что рекомендуется). ТАМ ГДЕ ТРЕБУЕТСЯ ВВОД С КЛАВИАТУРЫ - ПРОВЕРЯТЬ НЕСКОЛЬКО РАЗ, т.к. незначительная с виду опечатка может застопорить дело надолго. И вообще, по ходу пьесы, если что-то не так,  прежде чем валить с больной головы на здоровую, желательно остановиться и внимательно поглядеть на собственные руки - всё ли с ними впорядке? Не кривые ли они и оттуда ли растут.. Работоспособность системы была проверена на iPhone, Android и FirefoxOS (собственно проверялось поведение на разных браузерах под разными платформами) - всё работало как и задумывалось изначально.

Итак, приступим.

1. Для простоты (но никак не качества) и скорости был взят IIS7.5 т.к. система ForSec изначально была установлена на Win7 Prof. Т.е. веб-сервер и БД находились на одном компьютере. IIS устанавливается из Панель Управления -> Программы и компоненты -> Включение или отключение компонентов Windows (см. скриншоты).

2. Далее, поместите СОДЕРЖИМОЕ папки web/ (а НЕ САМУ ПАПКУ !!) в каталог C:\inetpub\wwwroot\ . Для надёжности можно переименовать файл iisstart.htm . Если вы собираетесь подключаться к веб-серверу с другого компьютера или моб. устройства, то надо в фаерволе активировать правило для входящих подключений по HTTP. Для быстрого теста подойдёт родной IE11.

3. Через Панель Управления -> Администрирование -> Источники данных (ODBC) -> Системный DSN создайте пару подключений к базам данных FireBird: тестовая - EMPLOYEE.fdb и рабочая ForSec - accpoint.gdb . В обоих случаях подойдут параметры "по умолчанию" с пользователем SYSDBA  и его паролем masterkey. Следует только правильно указать расположение файлов баз данных. Так же в свойствах самих файлов в закладке Безопасность следует добавить пользователя IIS_WPG с полным набором прав. Собственно employee.fdb нужен только в тестовых целях (как запасной источник данных) и в работе интерфейса участия не принимает.

4. Итак, у вас имеются два системных DSN: employee_db и accpoint_db . В каталоге C:\inetpub\wwwroot\ располагаются файлы index.html, fakereq.asp, odoor.asp и папка lib с файлами. Настало время экспериментов. Загляните в текстовый файл cli_odour.sql . Там три строки. Две первые точно такие же (почти) находятся и в файле odoor.asp . Ваша задача сводится к подбору значений, которые подходят для вашей конфигурации. Их не много, но отсюда у вас два пути. Один: использовать WireShark, другой - isql.exe (isql-fb).

5. Что касается WireShark, то в параметрах фильтрации следует указать ip адрес сервера с БД AccessPoint и порт 3050 (FireBird database port). Под Linux пользовались инструментом tcpdump в следующей форме:
  ```
sudo tcpdump -AnnNvv -i1 dst host 192.168.0.1 and port 3050 -w /tmp/AP-snif.tcpdump
```
для уточнения номера интерфейса, на котором нужно слушать (ключ -i), желательно выполнить следующую команду:
  ```
sudo tcpdump -D
```
и, естественно, заменить ip адрес адресом вашего сервера. Перед этим, чтобы исключить ненужный трафик,  следует запустить из Пуск -> AccessPoint -> Монитор и, зарегистрировавшись, выбрать один из планов на котором изображён замок с которым вы собираетесь работать. Желательно выбрать ближайший замок, потому, что при открытии он не будет издавать звукового сигнала (как при прикладывании карточки), а только щёлкать при открытии и закрытии замка. Вообще, желательно эту работу проводить в конце рабочего дня, когда народ уже разойдётся: и сетевой трафик будет меньше и дверями будут реже пользоваться. Либо, если дверь находится далеко - взять напарника.

6. Итак, wireshark или tcpdump заряжены. Монитор запущен. Правой кнопкой мыши вызываете контекстное меню и выбираете "Разблокировать Реле.." . После того, как анимация замка закончится, останавливаете wireshark/tcpdump и изучаете полученную информацию. Вас интересует всё, что связано с "INSERT.." . Сравните с тем, что находится в файле cli_odour.sql .

xxx Теперь через Панель Управления -> Администрирование -> Диспетчер служб IIS запускаем веб-сервер. Далее все сообщения от этого сервера мы читаем в логах по адресу C:\inetpub\logs\LogFiles\W3SVC1 . Замечание: у нас запись шла с задержкой в 2 минуты - мрак!
